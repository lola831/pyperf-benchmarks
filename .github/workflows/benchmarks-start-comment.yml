name: Benchmark Start Comment

on:
  workflow_run:
    workflows: ["Run Benchmarks"]
    types: [in_progress]

jobs:
  post-start-comment:
    if: github.event.workflow_run.event == 'issue_comment'
    runs-on: ubuntu-latest
    permissions:
      issues: write
    #   pull-requests: write ????
    #   issues: write ?????
    steps:
      - name: Post start comment and capture ID
        id: post_comment
        uses: actions/github-script@v7
        with:
          script: |
            const pr = github.event.workflow_run.pull_requests[0];
            if (!pr) {
              core.info("No pull request found in payload.");
              return;
            }
            const { data: comment } = await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: pr.number,
              body: 'ðŸš€ Benchmarks have started.'
            });
            // Set the comment ID as an output variable
            core.setOutput('comment_id', comment.id);
            return comment.id;
          result-encoding: string

      - name: Save comment ID to file
        run: echo "${{ steps.post_comment.outputs.comment_id }}" > comment_id.txt

      - name: Upload comment ID artifact
        uses: actions/upload-artifact@v4
        with:
          name: comment-id
          path: comment_id.txt
